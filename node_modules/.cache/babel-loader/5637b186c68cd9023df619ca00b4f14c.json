{"ast":null,"code":"import _regeneratorRuntime from\"/Users/leifu/Documents/restaurantorder/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/leifu/Documents/restaurantorder/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _taggedTemplateLiteral from\"/Users/leifu/Documents/restaurantorder/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";import _objectSpread from\"/Users/leifu/Documents/restaurantorder/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/leifu/Documents/restaurantorder/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";function _templateObject(){var data=_taggedTemplateLiteral([\"\\n        height: 40px;\\n        display: flex;\\n        align-items: center;\\n    \\n        & .StripeElement {\\n        width: 100%;\\n        padding: 10px;\\n        }\\n    \"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useState}from'react';import localServerAxios from\"axios\";import Spinner from'../UI/Spinner/Spinner';import classes from'./ContactData.module.css';import axios from'../../axios-orders';import Input from'../UI/Input/Input';import Row from\"./prebuilt/Row\";import SubmitButton from\"./prebuilt/SubmitButton\";import styled from\"@emotion/styled\";import{CardElement,useElements,useStripe}from'@stripe/react-stripe-js';var ContactData=function ContactData(props){var _useState=useState({name:{elementType:'input',elementConfig:{type:'text',placeholder:'Your Name',name:'name'},value:'',validation:{required:true},valid:false,touched:false},street:{elementType:'input',elementConfig:{type:'text',placeholder:'Street',name:'line1'},value:'',validation:{required:true},valid:false,touched:false},city:{elementType:'input',elementConfig:{type:'text',placeholder:'City',name:'city'},value:'',validation:{required:true},valid:false,touched:false},state:{elementType:'input',elementConfig:{type:'text',placeholder:'State',name:'state'},value:'',validation:{required:true},valid:false,touched:false},zipCode:{elementType:'input',elementConfig:{type:'text',placeholder:'ZIP Code',name:'zip'},value:'',validation:{required:true,minLength:5,maxLength:5,isNumeric:true},valid:false,touched:false},phone:{elementType:'input',elementConfig:{type:'text',placeholder:'Phone Number',name:'phone'},value:'',validation:{isNumeric:true},valid:false,touched:false},email:{elementType:'input',elementConfig:{type:'email',placeholder:'Your E-Mail',name:'email'},value:'',validation:{required:true,isEmail:true},valid:false,touched:false},deliveryMethod:{elementType:'select',elementConfig:{options:[{value:'fastest',displayValue:'Fastest'},{value:'cheapest',displayValue:'Cheapest'}],name:'deliveryMethod'},value:'',validation:{},valid:true}}),_useState2=_slicedToArray(_useState,2),orderForm=_useState2[0],setOrderForm=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),formIsValid=_useState4[0],setFormIsValid=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isProcessing=_useState8[0],setIsProcessing=_useState8[1];var checkValidity=function checkValidity(value,rules){var isValid=true;if(!rules){return true;}if(rules.required){isValid=value.trim()!==''&&isValid;}if(rules.minLength){isValid=value.length>=rules.minLength&&isValid;}if(rules.maxLength){isValid=value.length<=rules.maxLength&&isValid;}if(rules.isEmail){var pattern=/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;isValid=pattern.test(value)&&isValid;}if(rules.isNumeric){var _pattern=/^\\d+$/;isValid=_pattern.test(value)&&isValid;}return isValid;};var inputChangedHandler=function inputChangedHandler(event,inputIdentifier){var updatedOrderForm=_objectSpread({},orderForm);var updatedFormElement=_objectSpread({},updatedOrderForm[inputIdentifier]);updatedFormElement.value=event.target.value;updatedFormElement.valid=checkValidity(updatedFormElement.value,updatedFormElement.validation);updatedFormElement.touched=true;updatedOrderForm[inputIdentifier]=updatedFormElement;var formIsValid=true;for(var _inputIdentifier in updatedOrderForm){//console.log(updatedOrderForm[inputIdentifier],updatedOrderForm[inputIdentifier].valid);\nformIsValid=updatedOrderForm[_inputIdentifier].valid&&formIsValid;}//console.log('formIsValid',formIsValid);\nsetOrderForm(updatedOrderForm);setFormIsValid(formIsValid);};var cardElementOptions={style:{base:{fontSize:\"16px\",color:\"#9b9b9b\",\"::placeholder\":{color:\"#9b9b9b\"}},invalid:{color:'#aa272f',iconColor:'#aa272f'}},hidePostalCode:true};var CardElementContainer=styled.div(_templateObject());var stripe=useStripe();var elements=useElements();var handleFormSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(ev){var billingDetails,cardElement,res,clientSecret,result,formData,formElementIdentifier,updateDishes,order;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:ev.preventDefault();ev.persist();//submitHandler\n// setIsProcessing(true);\nbillingDetails={name:ev.target.name.value,email:ev.target.email.value,address:{city:ev.target.city.value,line1:ev.target.line1.value,state:ev.target.state.value,postal_code:ev.target.zip.value}};cardElement=elements.getElement(CardElement);_context.next=6;return localServerAxios.post('https://us-central1-restrauntordermenu.cloudfunctions.net/api/pay',{amount:(props.totalPrice*100).toFixed(0),billingDetails:billingDetails});case 6:res=_context.sent;// const res = await localServerAxios.post('http://localhost:8585/pay', {\n//     amount: (props.totalPrice*100).toFixed(0), \n//     billingDetails: billingDetails,\n//     })\nclientSecret=res.data['client_secret'];_context.next=10;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:cardElement,billing_details:billingDetails}});case 10:result=_context.sent;if(!result.error){_context.next=15;break;}// Show error to your customer (e.g., insufficient funds)\nconsole.log(result.error.message);_context.next=25;break;case 15:if(!(result.paymentIntent.status==='succeeded')){_context.next=25;break;}console.log('Money is in the bank!');//orderHandler\nsetLoading(true);formData={};for(formElementIdentifier in orderForm){formData[formElementIdentifier]=orderForm[formElementIdentifier].value;}updateDishes=_objectSpread({},props.dishes);Object.keys(updateDishes).forEach(function(key){return(updateDishes[key]===0||null)&&delete updateDishes[key];});order={dishes:updateDishes,price:props.totalPrice,orderData:formData};_context.next=25;return axios.post('/orders.json',order).then(function(response){console.log('toFirebase success');props.onSuccessfulCheckout();}).catch(function(error){setLoading(false);});case 25:case\"end\":return _context.stop();}}},_callee);}));return function handleFormSubmit(_x){return _ref.apply(this,arguments);};}();var formElementsArray=[];for(var key in orderForm){formElementsArray.push({id:key,config:orderForm[key]});}var form=/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleFormSubmit},formElementsArray.map(function(formElement){return/*#__PURE__*/React.createElement(Input,{key:formElement.id,elementType:formElement.config.elementType,elementConfig:formElement.config.elementConfig,value:formElement.config.value,invalid:!formElement.config.valid,shouldValidate:formElement.config.validation,touched:formElement.config.touched,changed:function changed(event){return inputChangedHandler(event,formElement.id);}});}),/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(CardElementContainer,null,/*#__PURE__*/React.createElement(CardElement,{options:cardElementOptions}))),/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(SubmitButton,{disabled:isProcessing||!formIsValid},isProcessing?\"Processing...\":\"Pay $\".concat(props.totalPrice))),/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(SubmitButton,{style:{backgroundColor:'#333',borderColor:'#333'},onClick:props.goBack},\"Cancle\"))));if(loading){form=/*#__PURE__*/React.createElement(Spinner,null);}return/*#__PURE__*/React.createElement(\"div\",{className:classes.ContactData},/*#__PURE__*/React.createElement(\"h4\",null,\"Enter your Contact Data & Pay\"),form);};export default ContactData;","map":{"version":3,"sources":["/Users/leifu/Documents/restaurantorder/src/Components/ContactData/ContactData.js"],"names":["React","useState","localServerAxios","Spinner","classes","axios","Input","Row","SubmitButton","styled","CardElement","useElements","useStripe","ContactData","props","name","elementType","elementConfig","type","placeholder","value","validation","required","valid","touched","street","city","state","zipCode","minLength","maxLength","isNumeric","phone","email","isEmail","deliveryMethod","options","displayValue","orderForm","setOrderForm","formIsValid","setFormIsValid","loading","setLoading","isProcessing","setIsProcessing","checkValidity","rules","isValid","trim","length","pattern","test","inputChangedHandler","event","inputIdentifier","updatedOrderForm","updatedFormElement","target","cardElementOptions","style","base","fontSize","color","invalid","iconColor","hidePostalCode","CardElementContainer","div","stripe","elements","handleFormSubmit","ev","preventDefault","persist","billingDetails","address","line1","postal_code","zip","cardElement","getElement","post","amount","totalPrice","toFixed","res","clientSecret","data","confirmCardPayment","payment_method","card","billing_details","result","error","console","log","message","paymentIntent","status","formData","formElementIdentifier","updateDishes","dishes","Object","keys","forEach","key","order","price","orderData","then","response","onSuccessfulCheckout","catch","formElementsArray","push","id","config","form","map","formElement","backgroundColor","borderColor","goBack"],"mappings":"klCAAA,MAAOA,CAAAA,KAAP,EAAeC,QAAf,KAA8B,OAA9B,CACA,MAAOC,CAAAA,gBAAP,KAA6B,OAA7B,CACA,MAAOC,CAAAA,OAAP,KAAoB,uBAApB,CACA,MAAOC,CAAAA,OAAP,KAAoB,0BAApB,CACA,MAAOC,CAAAA,KAAP,KAAkB,oBAAlB,CACA,MAAOC,CAAAA,KAAP,KAAkB,mBAAlB,CACA,MAAOC,CAAAA,GAAP,KAAgB,gBAAhB,CACA,MAAOC,CAAAA,YAAP,KAAyB,yBAAzB,CACA,MAAOC,CAAAA,MAAP,KAAmB,iBAAnB,CACA,OAAQC,WAAR,CAAqBC,WAArB,CAAkCC,SAAlC,KAAkD,yBAAlD,CAEA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACC,KAAD,CAAW,eACKb,QAAQ,CACtC,CACEc,IAAI,CAAE,CACFC,WAAW,CAAE,OADX,CAEFC,aAAa,CAAE,CACXC,IAAI,CAAE,MADK,CAEXC,WAAW,CAAE,WAFF,CAGXJ,IAAI,CAAE,MAHK,CAFb,CAOFK,KAAK,CAAE,EAPL,CAQFC,UAAU,CAAE,CACRC,QAAQ,CAAE,IADF,CARV,CAWFC,KAAK,CAAE,KAXL,CAYFC,OAAO,CAAE,KAZP,CADR,CAeEC,MAAM,CAAE,CACJT,WAAW,CAAE,OADT,CAEJC,aAAa,CAAE,CACXC,IAAI,CAAE,MADK,CAEXC,WAAW,CAAE,QAFF,CAGXJ,IAAI,CAAE,OAHK,CAFX,CAQJK,KAAK,CAAE,EARH,CASJC,UAAU,CAAE,CACRC,QAAQ,CAAE,IADF,CATR,CAYJC,KAAK,CAAE,KAZH,CAaJC,OAAO,CAAE,KAbL,CAfV,CA+BEE,IAAI,CAAE,CACFV,WAAW,CAAE,OADX,CAEFC,aAAa,CAAE,CACXC,IAAI,CAAE,MADK,CAEXC,WAAW,CAAE,MAFF,CAGXJ,IAAI,CAAE,MAHK,CAFb,CAOFK,KAAK,CAAE,EAPL,CAQFC,UAAU,CAAE,CACRC,QAAQ,CAAE,IADF,CARV,CAWFC,KAAK,CAAE,KAXL,CAYFC,OAAO,CAAE,KAZP,CA/BR,CA6CEG,KAAK,CAAE,CACHX,WAAW,CAAE,OADV,CAEHC,aAAa,CAAE,CACXC,IAAI,CAAE,MADK,CAEXC,WAAW,CAAE,OAFF,CAGXJ,IAAI,CAAE,OAHK,CAFZ,CAOHK,KAAK,CAAE,EAPJ,CAQHC,UAAU,CAAE,CACRC,QAAQ,CAAE,IADF,CART,CAWHC,KAAK,CAAE,KAXJ,CAYHC,OAAO,CAAE,KAZN,CA7CT,CA2DEI,OAAO,CAAE,CACLZ,WAAW,CAAE,OADR,CAELC,aAAa,CAAE,CACXC,IAAI,CAAE,MADK,CAEXC,WAAW,CAAE,UAFF,CAGXJ,IAAI,CAAE,KAHK,CAFV,CAOLK,KAAK,CAAE,EAPF,CAQLC,UAAU,CAAE,CACRC,QAAQ,CAAE,IADF,CAERO,SAAS,CAAE,CAFH,CAGRC,SAAS,CAAE,CAHH,CAIRC,SAAS,CAAE,IAJH,CARP,CAcLR,KAAK,CAAE,KAdF,CAeLC,OAAO,CAAE,KAfJ,CA3DX,CA4EEQ,KAAK,CAAE,CACHhB,WAAW,CAAE,OADV,CAEHC,aAAa,CAAE,CACXC,IAAI,CAAE,MADK,CAEXC,WAAW,CAAE,cAFF,CAGXJ,IAAI,CAAE,OAHK,CAFZ,CAOHK,KAAK,CAAE,EAPJ,CAQHC,UAAU,CAAE,CACRU,SAAS,CAAE,IADH,CART,CAWHR,KAAK,CAAE,KAXJ,CAYHC,OAAO,CAAE,KAZN,CA5ET,CA0FES,KAAK,CAAE,CACHjB,WAAW,CAAE,OADV,CAEHC,aAAa,CAAE,CACXC,IAAI,CAAE,OADK,CAEXC,WAAW,CAAE,aAFF,CAGXJ,IAAI,CAAC,OAHM,CAFZ,CAOHK,KAAK,CAAE,EAPJ,CAQHC,UAAU,CAAE,CACRC,QAAQ,CAAE,IADF,CAERY,OAAO,CAAE,IAFD,CART,CAYHX,KAAK,CAAE,KAZJ,CAaHC,OAAO,CAAE,KAbN,CA1FT,CAyGEW,cAAc,CAAE,CACZnB,WAAW,CAAE,QADD,CAEZC,aAAa,CAAE,CACXmB,OAAO,CAAE,CACL,CAAChB,KAAK,CAAE,SAAR,CAAmBiB,YAAY,CAAE,SAAjC,CADK,CAEL,CAACjB,KAAK,CAAE,UAAR,CAAoBiB,YAAY,CAAE,UAAlC,CAFK,CADE,CAKXtB,IAAI,CAAC,gBALM,CAFH,CASZK,KAAK,CAAE,EATK,CAUZC,UAAU,CAAE,EAVA,CAWZE,KAAK,CAAE,IAXK,CAzGlB,CADsC,CADb,wCACtBe,SADsB,eACXC,YADW,8BAyHetC,QAAQ,CAAC,KAAD,CAzHvB,yCAyHhBuC,WAzHgB,eAyHHC,cAzHG,8BA0HOxC,QAAQ,CAAC,KAAD,CA1Hf,yCA0HhByC,OA1HgB,eA0HPC,UA1HO,8BA2HiB1C,QAAQ,CAAC,KAAD,CA3HzB,yCA2HhB2C,YA3HgB,eA2HFC,eA3HE,eA6H3B,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAAC1B,KAAD,CAAQ2B,KAAR,CAAkB,CACpC,GAAIC,CAAAA,OAAO,CAAG,IAAd,CACA,GAAI,CAACD,KAAL,CAAY,CACR,MAAO,KAAP,CACH,CAED,GAAIA,KAAK,CAACzB,QAAV,CAAoB,CAChB0B,OAAO,CAAG5B,KAAK,CAAC6B,IAAN,KAAiB,EAAjB,EAAuBD,OAAjC,CACH,CAED,GAAID,KAAK,CAAClB,SAAV,CAAqB,CACjBmB,OAAO,CAAG5B,KAAK,CAAC8B,MAAN,EAAgBH,KAAK,CAAClB,SAAtB,EAAmCmB,OAA7C,CACH,CAED,GAAID,KAAK,CAACjB,SAAV,CAAqB,CACjBkB,OAAO,CAAG5B,KAAK,CAAC8B,MAAN,EAAgBH,KAAK,CAACjB,SAAtB,EAAmCkB,OAA7C,CACH,CAED,GAAID,KAAK,CAACb,OAAV,CAAmB,CACf,GAAMiB,CAAAA,OAAO,CAAG,uIAAhB,CACAH,OAAO,CAAGG,OAAO,CAACC,IAAR,CAAahC,KAAb,GAAuB4B,OAAjC,CACH,CAED,GAAID,KAAK,CAAChB,SAAV,CAAqB,CACjB,GAAMoB,CAAAA,QAAO,CAAG,OAAhB,CACAH,OAAO,CAAGG,QAAO,CAACC,IAAR,CAAahC,KAAb,GAAuB4B,OAAjC,CACH,CAED,MAAOA,CAAAA,OAAP,CACH,CA7BD,CA+BA,GAAMK,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,CAACC,KAAD,CAAQC,eAAR,CAA4B,CACpD,GAAMC,CAAAA,gBAAgB,kBACflB,SADe,CAAtB,CAGA,GAAMmB,CAAAA,kBAAkB,kBACjBD,gBAAgB,CAACD,eAAD,CADC,CAAxB,CAGAE,kBAAkB,CAACrC,KAAnB,CAA2BkC,KAAK,CAACI,MAAN,CAAatC,KAAxC,CACAqC,kBAAkB,CAAClC,KAAnB,CAA2BuB,aAAa,CAACW,kBAAkB,CAACrC,KAApB,CAA2BqC,kBAAkB,CAACpC,UAA9C,CAAxC,CACAoC,kBAAkB,CAACjC,OAAnB,CAA6B,IAA7B,CACAgC,gBAAgB,CAACD,eAAD,CAAhB,CAAoCE,kBAApC,CAEA,GAAIjB,CAAAA,WAAW,CAAG,IAAlB,CACA,IAAK,GAAIe,CAAAA,gBAAT,GAA4BC,CAAAA,gBAA5B,CAA8C,CAC1C;AACAhB,WAAW,CAAGgB,gBAAgB,CAACD,gBAAD,CAAhB,CAAkChC,KAAlC,EAA2CiB,WAAzD,CACH,CACD;AACAD,YAAY,CAACiB,gBAAD,CAAZ,CACAf,cAAc,CAACD,WAAD,CAAd,CACH,CApBD,CAuBA,GAAMmB,CAAAA,kBAAkB,CAAG,CACvBC,KAAK,CAAE,CACHC,IAAI,CAAE,CACFC,QAAQ,CAAE,MADR,CAEFC,KAAK,CAAE,SAFL,CAGF,gBAAiB,CACbA,KAAK,CAAE,SADM,CAHf,CADH,CASHC,OAAO,CAAE,CACLD,KAAK,CAAE,SADF,CAELE,SAAS,CAAE,SAFN,CATN,CADgB,CAevBC,cAAc,CAAE,IAfO,CAA3B,CAoBA,GAAMC,CAAAA,oBAAoB,CAAG1D,MAAM,CAAC2D,GAAV,mBAA1B,CAWA,GAAMC,CAAAA,MAAM,CAAGzD,SAAS,EAAxB,CACA,GAAM0D,CAAAA,QAAQ,CAAG3D,WAAW,EAA5B,CAEA,GAAM4D,CAAAA,gBAAgB,0FAAG,iBAAMC,EAAN,2NACrBA,EAAE,CAACC,cAAH,GACAD,EAAE,CAACE,OAAH,GAEA;AACA;AACMC,cANe,CAME,CACnB5D,IAAI,CAAEyD,EAAE,CAACd,MAAH,CAAU3C,IAAV,CAAeK,KADF,CAEnBa,KAAK,CAAEuC,EAAE,CAACd,MAAH,CAAUzB,KAAV,CAAgBb,KAFJ,CAGnBwD,OAAO,CAAE,CACTlD,IAAI,CAAE8C,EAAE,CAACd,MAAH,CAAUhC,IAAV,CAAeN,KADZ,CAETyD,KAAK,CAAEL,EAAE,CAACd,MAAH,CAAUmB,KAAV,CAAgBzD,KAFd,CAGTO,KAAK,CAAE6C,EAAE,CAACd,MAAH,CAAU/B,KAAV,CAAgBP,KAHd,CAIT0D,WAAW,CAAEN,EAAE,CAACd,MAAH,CAAUqB,GAAV,CAAc3D,KAJlB,CAHU,CANF,CAiBf4D,WAjBe,CAiBDV,QAAQ,CAACW,UAAT,CAAoBvE,WAApB,CAjBC,uBAmBHR,CAAAA,gBAAgB,CAACgF,IAAjB,CAAsB,mEAAtB,CAA2F,CAC7GC,MAAM,CAAE,CAACrE,KAAK,CAACsE,UAAN,CAAiB,GAAlB,EAAuBC,OAAvB,CAA+B,CAA/B,CADqG,CAE7GV,cAAc,CAAEA,cAF6F,CAA3F,CAnBG,QAmBfW,GAnBe,eAwBrB;AACA;AACA;AACA;AACMC,YA5Be,CA4BAD,GAAG,CAACE,IAAJ,CAAS,eAAT,CA5BA,wBA6BAnB,CAAAA,MAAM,CAACoB,kBAAP,CAA0BF,YAA1B,CAAwC,CACzDG,cAAc,CAAE,CACdC,IAAI,CAAEX,WADQ,CAEdY,eAAe,CAAEjB,cAFH,CADyC,CAAxC,CA7BA,SA6BfkB,MA7Be,mBAoCfA,MAAM,CAACC,KApCQ,0BAqCjB;AACAC,OAAO,CAACC,GAAR,CAAYH,MAAM,CAACC,KAAP,CAAaG,OAAzB,EAtCiB,oCAyCbJ,MAAM,CAACK,aAAP,CAAqBC,MAArB,GAAgC,WAzCnB,2BA0CfJ,OAAO,CAACC,GAAR,CAAY,uBAAZ,EACC;AACPrD,UAAU,CAAC,IAAD,CAAV,CACMyD,QA7Ce,CA6CJ,EA7CI,CA8CrB,IAASC,qBAAT,GAAkC/D,CAAAA,SAAlC,CAA6C,CACzC8D,QAAQ,CAACC,qBAAD,CAAR,CAAkC/D,SAAS,CAAC+D,qBAAD,CAAT,CAAiCjF,KAAnE,CACH,CACGkF,YAjDiB,kBAiDExF,KAAK,CAACyF,MAjDR,EAkDrBC,MAAM,CAACC,IAAP,CAAYH,YAAZ,EAA0BI,OAA1B,CAAkC,SAACC,GAAD,QAAS,CAACL,YAAY,CAACK,GAAD,CAAZ,GAAsB,CAAtB,EAAyB,IAA1B,GAAmC,MAAOL,CAAAA,YAAY,CAACK,GAAD,CAA/D,EAAlC,EAEMC,KApDe,CAoDP,CACVL,MAAM,CAAED,YADE,CAEVO,KAAK,CAAE/F,KAAK,CAACsE,UAFH,CAGV0B,SAAS,CAAEV,QAHD,CApDO,wBAyDf/F,CAAAA,KAAK,CAAC6E,IAAN,CAAY,cAAZ,CAA4B0B,KAA5B,EACDG,IADC,CACK,SAAAC,QAAQ,CAAI,CAChBjB,OAAO,CAACC,GAAR,CAAY,oBAAZ,EACAlF,KAAK,CAACmG,oBAAN,GACF,CAJC,EAKDC,KALC,CAKM,SAAApB,KAAK,CAAI,CACbnD,UAAU,CAAC,KAAD,CAAV,CACH,CAPC,CAzDe,wDAAH,kBAAhB4B,CAAAA,gBAAgB,4CAAtB,CAwEA,GAAM4C,CAAAA,iBAAiB,CAAG,EAA1B,CACA,IAAK,GAAIR,CAAAA,GAAT,GAAgBrE,CAAAA,SAAhB,CAA2B,CACvB6E,iBAAiB,CAACC,IAAlB,CAAuB,CACnBC,EAAE,CAAEV,GADe,CAEnBW,MAAM,CAAEhF,SAAS,CAACqE,GAAD,CAFE,CAAvB,EAIH,CACD,GAAIY,CAAAA,IAAI,cACJ,4CACA,4BAAM,QAAQ,CAAEhD,gBAAhB,EACK4C,iBAAiB,CAACK,GAAlB,CAAsB,SAAAC,WAAW,qBAC9B,oBAAC,KAAD,EACI,GAAG,CAAEA,WAAW,CAACJ,EADrB,CAEI,WAAW,CAAEI,WAAW,CAACH,MAAZ,CAAmBtG,WAFpC,CAGI,aAAa,CAAEyG,WAAW,CAACH,MAAZ,CAAmBrG,aAHtC,CAII,KAAK,CAAEwG,WAAW,CAACH,MAAZ,CAAmBlG,KAJ9B,CAKI,OAAO,CAAE,CAACqG,WAAW,CAACH,MAAZ,CAAmB/F,KALjC,CAMI,cAAc,CAAEkG,WAAW,CAACH,MAAZ,CAAmBjG,UANvC,CAOI,OAAO,CAAEoG,WAAW,CAACH,MAAZ,CAAmB9F,OAPhC,CAQI,OAAO,CAAE,iBAAC8B,KAAD,QAAWD,CAAAA,mBAAmB,CAACC,KAAD,CAAQmE,WAAW,CAACJ,EAApB,CAA9B,EARb,EAD8B,EAAjC,CADL,cAYQ,oBAAC,GAAD,mBACI,oBAAC,oBAAD,mBACA,oBAAC,WAAD,EAAa,OAAO,CAAE1D,kBAAtB,EADA,CADJ,CAZR,cAkBQ,oBAAC,GAAD,mBACI,oBAAC,YAAD,EAAc,QAAQ,CAAEf,YAAY,EAAE,CAACJ,WAAvC,EACCI,YAAY,CAAG,eAAH,gBAA6B9B,KAAK,CAACsE,UAAnC,CADb,CADJ,CAlBR,cAwBQ,oBAAC,GAAD,mBACI,oBAAC,YAAD,EAAe,KAAK,CAAE,CAAEsC,eAAe,CAAE,MAAnB,CAA2BC,WAAW,CAAC,MAAvC,CAAtB,CAAuE,OAAO,CAAI7G,KAAK,CAAC8G,MAAxF,WADJ,CAxBR,CADA,CADJ,CAkCA,GAAKlF,OAAL,CAAe,CACX6E,IAAI,cAAG,oBAAC,OAAD,MAAP,CACH,CAED,mBACI,2BAAK,SAAS,CAAEnH,OAAO,CAACS,WAAxB,eACI,8DADJ,CAEK0G,IAFL,CADJ,CAMH,CAhVD,CAkVA,cAAe1G,CAAAA,WAAf","sourcesContent":["import React, {useState} from 'react';\nimport localServerAxios from \"axios\";\nimport Spinner from '../UI/Spinner/Spinner';\nimport classes from './ContactData.module.css';\nimport axios from '../../axios-orders';\nimport Input from '../UI/Input/Input';\nimport Row from \"./prebuilt/Row\";\nimport SubmitButton from \"./prebuilt/SubmitButton\";\nimport styled from \"@emotion/styled\";\nimport {CardElement, useElements, useStripe} from '@stripe/react-stripe-js';\n\nconst ContactData = (props) => {\n  const [orderForm, setOrderForm] = useState (\n      {\n        name: {\n            elementType: 'input',\n            elementConfig: {\n                type: 'text',\n                placeholder: 'Your Name',\n                name: 'name'\n            },\n            value: '',\n            validation: {\n                required: true\n            },\n            valid: false,\n            touched: false\n        },\n        street: {\n            elementType: 'input',\n            elementConfig: {\n                type: 'text',\n                placeholder: 'Street',\n                name: 'line1'\n\n            },\n            value: '',\n            validation: {\n                required: true\n            },\n            valid: false,\n            touched: false\n        },\n       \n        city: {\n            elementType: 'input',\n            elementConfig: {\n                type: 'text',\n                placeholder: 'City',\n                name: 'city'\n            },\n            value: '',\n            validation: {\n                required: true\n            },\n            valid: false,\n            touched: false\n        },\n        state: {\n            elementType: 'input',\n            elementConfig: {\n                type: 'text',\n                placeholder: 'State',\n                name: 'state'\n            },\n            value: '',\n            validation: {\n                required: true\n            },\n            valid: false,\n            touched: false\n        },\n        zipCode: {\n            elementType: 'input',\n            elementConfig: {\n                type: 'text',\n                placeholder: 'ZIP Code',\n                name: 'zip'\n            },\n            value: '',\n            validation: {\n                required: true,\n                minLength: 5,\n                maxLength: 5,\n                isNumeric: true\n            },\n            valid: false,\n            touched: false\n        },\n        phone: {\n            elementType: 'input',\n            elementConfig: {\n                type: 'text',\n                placeholder: 'Phone Number',\n                name: 'phone'\n            },\n            value: '',\n            validation: {\n                isNumeric: true\n            },\n            valid: false,\n            touched: false\n        },\n        email: {\n            elementType: 'input',\n            elementConfig: {\n                type: 'email',\n                placeholder: 'Your E-Mail',\n                name:'email'\n            },\n            value: '',\n            validation: {\n                required: true,\n                isEmail: true\n            },\n            valid: false,\n            touched: false\n        },\n        deliveryMethod: {\n            elementType: 'select',\n            elementConfig: {\n                options: [\n                    {value: 'fastest', displayValue: 'Fastest'},\n                    {value: 'cheapest', displayValue: 'Cheapest'}\n                ],\n                name:'deliveryMethod'\n            },\n            value: '',\n            validation: {},\n            valid: true\n        }\n    }) \n        const [formIsValid, setFormIsValid] = useState(false);\n        const [loading, setLoading] = useState(false);\n        const [isProcessing, setIsProcessing] = useState(false);\n    \n    const checkValidity = (value, rules) => {\n        let isValid = true;\n        if (!rules) {\n            return true;\n        }\n        \n        if (rules.required) {\n            isValid = value.trim() !== '' && isValid;\n        }\n\n        if (rules.minLength) {\n            isValid = value.length >= rules.minLength && isValid\n        }\n\n        if (rules.maxLength) {\n            isValid = value.length <= rules.maxLength && isValid\n        }\n\n        if (rules.isEmail) {\n            const pattern = /[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;\n            isValid = pattern.test(value) && isValid\n        }\n\n        if (rules.isNumeric) {\n            const pattern = /^\\d+$/;\n            isValid = pattern.test(value) && isValid\n        }\n\n        return isValid;\n    }\n\n    const inputChangedHandler = (event, inputIdentifier) => {\n        const updatedOrderForm = {\n            ...orderForm\n        };\n        const updatedFormElement = { \n            ...updatedOrderForm[inputIdentifier]\n        };\n        updatedFormElement.value = event.target.value;\n        updatedFormElement.valid = checkValidity(updatedFormElement.value, updatedFormElement.validation);\n        updatedFormElement.touched = true;\n        updatedOrderForm[inputIdentifier] = updatedFormElement;\n        \n        let formIsValid = true;\n        for (let inputIdentifier in updatedOrderForm) {\n            //console.log(updatedOrderForm[inputIdentifier],updatedOrderForm[inputIdentifier].valid);\n            formIsValid = updatedOrderForm[inputIdentifier].valid && formIsValid;\n        }\n        //console.log('formIsValid',formIsValid);\n        setOrderForm(updatedOrderForm); \n        setFormIsValid(formIsValid);\n    }\n    \n  \n    const cardElementOptions = {\n        style: {\n            base: {\n                fontSize: \"16px\",\n                color: \"#9b9b9b\",\n                \"::placeholder\": {\n                    color: \"#9b9b9b\"\n                }\n\n            },\n            invalid: {\n                color: '#aa272f',\n                iconColor: '#aa272f',\n            }   \n        },\n        hidePostalCode: true,\n    }\n\n\n\n    const CardElementContainer = styled.div`\n        height: 40px;\n        display: flex;\n        align-items: center;\n    \n        & .StripeElement {\n        width: 100%;\n        padding: 10px;\n        }\n    `;\n    \n    const stripe = useStripe();\n    const elements = useElements();\n\n    const handleFormSubmit = async ev => {\n        ev.preventDefault();\n        ev.persist()\n        \n        //submitHandler\n        // setIsProcessing(true);\n        const billingDetails = {\n            name: ev.target.name.value,\n            email: ev.target.email.value,\n            address: {\n            city: ev.target.city.value,\n            line1: ev.target.line1.value,\n            state: ev.target.state.value,\n            postal_code: ev.target.zip.value\n            }\n        }\n        \n        const cardElement = elements.getElement(CardElement);\n       \n        const res = await localServerAxios.post('https://us-central1-restrauntordermenu.cloudfunctions.net/api/pay', {\n        amount: (props.totalPrice*100).toFixed(0), \n        billingDetails: billingDetails,\n        })\n\n        // const res = await localServerAxios.post('http://localhost:8585/pay', {\n        //     amount: (props.totalPrice*100).toFixed(0), \n        //     billingDetails: billingDetails,\n        //     })\n        const clientSecret = res.data['client_secret'];\n        const result = await stripe.confirmCardPayment(clientSecret, {\n            payment_method: {\n              card: cardElement,\n              billing_details: billingDetails\n            },\n          });\n\n          if (result.error) {\n            // Show error to your customer (e.g., insufficient funds)\n            console.log(result.error.message);\n          } else {\n            // The payment has been processed!\n            if (result.paymentIntent.status === 'succeeded') {\n              console.log('Money is in the bank!');\n               //orderHandler\n        setLoading(true);\n        const formData = {};\n        for (let formElementIdentifier in orderForm) {\n            formData[formElementIdentifier] = orderForm[formElementIdentifier].value;\n        }\n        let updateDishes = {...props.dishes};\n        Object.keys(updateDishes).forEach((key) => (updateDishes[key] === 0||null) && delete updateDishes[key]);\n\n        const order = {\n            dishes: updateDishes,\n            price: props.totalPrice,\n            orderData: formData\n        }\n        await axios.post( '/orders.json', order )\n            .then( response => {\n               console.log('toFirebase success')\n               props.onSuccessfulCheckout();\n            } )\n            .catch( error => {\n                setLoading(false);\n            } );\n\n            }\n          }\n\n        };\n\n\n    const formElementsArray = [];\n    for (let key in orderForm) {\n        formElementsArray.push({\n            id: key,\n            config: orderForm[key]\n        });\n    }\n    let form = (\n        <div>\n        <form onSubmit={handleFormSubmit}>\n            {formElementsArray.map(formElement => (\n                <Input \n                    key={formElement.id}\n                    elementType={formElement.config.elementType}\n                    elementConfig={formElement.config.elementConfig}\n                    value={formElement.config.value}\n                    invalid={!formElement.config.valid}\n                    shouldValidate={formElement.config.validation}\n                    touched={formElement.config.touched}\n                    changed={(event) => inputChangedHandler(event, formElement.id)} />\n            ))}\n                <Row>\n                    <CardElementContainer>\n                    <CardElement options={cardElementOptions}/>\n                    </CardElementContainer>\n                </Row>\n\n                <Row>\n                    <SubmitButton disabled={isProcessing||!formIsValid}>\n                    {isProcessing ? \"Processing...\" : `Pay $${props.totalPrice}`}\n                    </SubmitButton>\n                </Row>\n\n                <Row>\n                    <SubmitButton  style={{ backgroundColor: '#333', borderColor:'#333' }} onClick = {props.goBack}>Cancle</SubmitButton>\n                </Row>\n\n             </form>      \n           </div>\n       \n    );\n    if ( loading ) {\n        form = <Spinner />;\n    }\n        \n    return (\n        <div className={classes.ContactData}>\n            <h4>Enter your Contact Data & Pay</h4>\n            {form}\n        </div>\n    );\n}\n\nexport default ContactData;"]},"metadata":{},"sourceType":"module"}